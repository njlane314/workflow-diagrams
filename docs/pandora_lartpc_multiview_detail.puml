@startuml Pandora_LArTPC_MultiViewDetail
' ============================================================
' Pandora reconstruction in LArTPCs — multi-view 2D→3D detail
' (per-slice conceptual view)
' ============================================================

!$BG        = "#0B1020"
!$FG        = "#EAF0FF"
!$PKG       = "#0E152F"

!$PAND_BG   = "#2A1F4A"
!$PAND_BR   = "#B388FF"
!$DATA_BG   = "#1E1E1E"
!$DATA_BR   = "#FFCA3A"
!$NOTE_BG   = "#141A33"
!$NOTE_BR   = "#3E4C80"

skinparam backgroundColor $BG
skinparam defaultFontColor $FG
skinparam shadowing false
skinparam roundcorner 16
skinparam linetype ortho
skinparam ArrowColor "#AAB8FF"
skinparam ArrowThickness 2
skinparam componentStyle rectangle

skinparam component<<pandora>> {
  BackgroundColor $PAND_BG
  BorderColor $PAND_BR
  FontColor $FG
}
skinparam artifact<<data>> {
  BackgroundColor $DATA_BG
  BorderColor $DATA_BR
  FontColor "#FFF4D6"
}
skinparam note {
  BackgroundColor $NOTE_BG
  BorderColor $NOTE_BR
  FontColor $FG
}

title <size:18><b>Inside Pandora (per slice): multi-view 2D → 3D pattern recognition</b></size>

artifact "Slice CaloHits\n(all planes: U, V, Y)" as SLICEH <<data>>

together {
  package "U view (induction)" as U #$PKG {
    artifact "U CaloHits" as UH <<data>>
    component "2D clustering U\n(seed/grow/split/merge)" as UC <<pandora>>
    artifact "2D clusters U" as U2 <<data>>
    UH --> UC --> U2
  }

  package "V view (induction)" as V #$PKG {
    artifact "V CaloHits" as VH <<data>>
    component "2D clustering V\n(seed/grow/split/merge)" as VC <<pandora>>
    artifact "2D clusters V" as V2 <<data>>
    VH --> VC --> V2
  }

  package "Y view (collection)" as Y #$PKG {
    artifact "Y CaloHits" as YH <<data>>
    component "2D clustering Y\n(seed/grow/split/merge)" as YC <<pandora>>
    artifact "2D clusters Y" as Y2 <<data>>
    YH --> YC --> Y2
  }
}

SLICEH --> UH
SLICEH --> VH
SLICEH --> YH

component "Cross-view association\n(match 2D clusters across planes)\nusing geometry + drift-time consistency" as XVIEW <<pandora>>
artifact "3D clusters / prongs\n(spacepoints, skeletons)" as C3D <<data>>

U2 --> XVIEW
V2 --> XVIEW
Y2 --> XVIEW
XVIEW --> C3D

component "Topology refinement (iterative)\n• resolve ambiguities\n• missing-view recovery\n• fragment removal\n• prong splitting/merging" as REF <<pandora>>
component "Track vs shower building\n• track-like: linear, MIP-like\n• shower-like: branching, increasing width" as TS <<pandora>>
component "Vertex hypothesis\n(connect prongs to common origin)" as VTX <<pandora>>
component "PFO hierarchy assembly\n(parent–daughter, interaction tree)" as PFO <<pandora>>
artifact "Slice-level PFOs\n+ associations & scores" as OUT <<data>>

C3D --> REF --> TS --> VTX --> PFO --> OUT

note right of XVIEW
**Principle:** each view gives a 2D projection.
3D comes from combining:
• shared drift coordinate (x from time)\n• wire geometry constraints\n• topological consistency
end note

note right of TS
**Discriminants (typical):**
• track: straightness, constant dQ/dx\n• shower: start dE/dx, spread, branching
end note

@enduml
